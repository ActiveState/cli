# Go
# Build your Go project.
# Add steps that test, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/go

pr: none

jobs:

  - job: linux
    pool:
      vmImage: ubuntu-16.04
    variables:
      - group: Secrets
      - name: SHELL
        value: /bin/bash
      - name: CI
        value: azure
      - name: GOPATH
        value: /home/vsts_azpcontainer/go
      - name: GOBIN
        value: /home/vsts_azpcontainer/go/bin
      - name: GOROOT
        value: /usr/local/go1.11'
    steps:
      - script: |
          printenv
          echo '##vso[task.prependpath]/home/vsts_azpcontainer/go/bin'
          echo '##vso[task.prependpath]/home/vsts_azpcontainer/bin'

          mkdir -p /home/vsts_azpcontainer/go/bin
          mkdir -p /home/vsts_azpcontainer/bin

          curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-0.6.3-linux-amd64 > /home/vsts_azpcontainer/bin/cc-test-reporter
          chmod +x /home/vsts_azpcontainer/bin/cc-test-reporter
        displayName: Prepare Agent
      - template: steps.yml

  - job: macos
    condition: false
    pool:
      vmImage: macos-10.13
    variables:
      - group: Secrets
      - name: SHELL
        value: /bin/bash
      - name: CI
        value: azure
      - name: GOPATH
        value: /Users/vsts/go
    steps:
      - script: |
          echo '##vso[task.prependpath]/Users/vsts/go/bin'
        displayName: Prepare Agent
      - template: steps.yml