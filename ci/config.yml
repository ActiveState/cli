# Go
# Build your Go project.
# Add steps that test, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/go


trigger:
  - master

resources:
  containers:
  - container: linux
    image: activestate/cli-build-ci-linux:latest

jobs:

  - job: linux
    pool:
      vmImage: ubuntu-16.04
    container: linux
    variables:
      - group: Secrets
      - name: SHELL
        value: /bin/bash
      - name: CI
        value: azure
    steps:
      - template: steps.yml

  - job: macos
    pool:
      vmImage: macos-10.13
    variables:
      - group: Secrets
      - name: SHELL
        value: /bin/bash
      - name: CI
        value: azure
      - name: GOFLAGS
        value: -mod=vendor
      - name: GOPATH
        value: /Users/vsts/go
    steps:
      - script: |
          set -e
          go get -v github.com/gobuffalo/packr/packr
          go get -v github.com/jstemmer/go-junit-report
          echo '##vso[task.prependpath]/Users/vsts/go/bin'
        displayName: Prepare Environment
      - template: steps.yml